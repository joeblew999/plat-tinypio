# ============================================================================
# GENERATED FILE - DO NOT EDIT MANUALLY
# ============================================================================
# Generated by: xplat gen service
# Regenerate with: xplat gen service --force
# Source: https://github.com/joeblew999/xplat
# Template: internal/templates/project/service.taskfile.yml.tmpl
# ============================================================================
#
# Reusable service taskfile for remote inclusion by xplat consumers.
# Consumers include this via: xplat pkg install plat-tinypio
#
# Provides standardized service management tasks (start, stop, status)
# that work with the tinypio binary installed by xplat.
# ============================================================================

version: "3"

vars:
  TINYPIO_BIN: '{{ .TINYPIO_BIN | default "tinypio" }}'
  TINYPIO_PORT: '{{ .TINYPIO_PORT | default "8090" }}'
  TINYPIO_HOST: '{{ .TINYPIO_HOST | default "0.0.0.0" }}'

tasks:
  start:
    desc: Start the plat-tinypio service
    cmds:
      - '{{ .TINYPIO_BIN }} serve --port {{ .TINYPIO_PORT }} --host {{ .TINYPIO_HOST }}'

  stop:
    desc: Stop the plat-tinypio service
    cmds:
      - pkill -f "{{ .TINYPIO_BIN }} serve" || true

  status:
    desc: Check if plat-tinypio service is running
    cmds:
      - |
        if curl -s http://{{ .TINYPIO_HOST | default "127.0.0.1" }}:{{ .TINYPIO_PORT }}/health > /dev/null 2>&1; then
          echo "plat-tinypio: running on port {{ .TINYPIO_PORT }}"
        else
          echo "plat-tinypio: not running"
          exit 1
        fi

  health:
    desc: Check plat-tinypio service health endpoint
    cmds:
      - curl -s http://{{ .TINYPIO_HOST | default "127.0.0.1" }}:{{ .TINYPIO_PORT }}/health | jq . || echo "plat-tinypio: not responding"

  restart:
    desc: Restart the plat-tinypio service
    cmds:
      - task: stop
      - task: start

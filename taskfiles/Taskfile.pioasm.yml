# pioasm - PIO Assembler from pico-sdk
version: "3"

vars:
  PIOASM_BIN: .bin/pioasm
  PIOASM_SRC: .src/pico-sdk
  PIOASM_REPO: https://github.com/raspberrypi/pico-sdk.git

tasks:
  default:
    desc: Build pioasm if not present
    cmds:
      - task: pioasm:build
    status:
      - test -f {{.PIOASM_BIN}}

  build:
    desc: Build pioasm from pico-sdk
    cmds:
      - mkdir -p .src .bin
      - git clone --depth 1 {{.PIOASM_REPO}} {{.PIOASM_SRC}}
      - cmake -B {{.PIOASM_SRC}}/tools/pioasm/build {{.PIOASM_SRC}}/tools/pioasm
      - cmake --build {{.PIOASM_SRC}}/tools/pioasm/build
      - cp {{.PIOASM_SRC}}/tools/pioasm/build/pioasm {{.PIOASM_BIN}}
    status:
      - test -f {{.PIOASM_BIN}}

  clean:
    desc: Remove pioasm and pico-sdk
    cmds:
      - rm -f {{.PIOASM_BIN}}
      - rm -rf {{.PIOASM_SRC}}

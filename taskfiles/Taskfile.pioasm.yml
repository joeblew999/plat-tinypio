# pioasm tasks - PIO Assembler from pico-sdk
version: "3"

tasks:
  check:
    desc: Check if pioasm is available
    cmds:
      - |
        if [ -f ".bin/pioasm" ]; then
          echo "pioasm found: .bin/pioasm"
        elif command -v pioasm &> /dev/null; then
          echo "pioasm found: $(which pioasm)"
        else
          echo "pioasm not found. Run 'task -t taskfiles/Taskfile.pioasm.yml install'"
          exit 1
        fi

  install:
    desc: Build pioasm from pico-sdk into .bin/
    cmds:
      - |
        set -e
        mkdir -p .src .bin
        if [ ! -d ".src/pico-sdk" ]; then
          echo "Cloning pico-sdk..."
          git clone --depth 1 https://github.com/raspberrypi/pico-sdk.git .src/pico-sdk
        fi
        echo "Building pioasm..."
        cd .src/pico-sdk/tools/pioasm
        cmake -B build .
        cmake --build build
        cp build/pioasm ../../../../.bin/
        echo "pioasm installed to .bin/pioasm"

  clean:
    desc: Remove pioasm and pico-sdk
    cmds:
      - rm -f .bin/pioasm
      - rm -rf .src/pico-sdk
      - echo "Cleaned pioasm"
